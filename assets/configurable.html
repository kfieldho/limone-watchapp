<!DOCTYPE html>
<html>
<head>
<title>Limone Configuration</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<h1 class='title'>Limone Configuration</h1>
<main>
<section>
<h2>IFTTT Maker channel</h2>
<p>
<label>token</label>
<input id="ifttt_token" type="password">
</p>
<p>
<label>event name</label>
<input id="ifttt_event" type="text" autocapitalize="off">
</p>
<p>
<label>start time format</label>
<input id="start_fmt" type="text" placeholder="%Y-%m-%dT%H:%M:%S%z" autocapitalize="off">
</p>
<p>
<label>end time format</label>
<input id="end_fmt" type="text" placeholder="%Y-%m-%dT%H:%M:%S%z" autocapitalize="off">
</p>
</section>
<section>
<h2>Todoist</h2>
<p>
<label>token</label>
<input type="password" name="todoist_token">
</p>
</section>
<section>
<p><button id="submit" type="submit">Submit</button></p>
</section>
</main>
</body>
<script>
"use strict;"
var keys = ["ifttt_token", "ifttt_event", "start_fmt", "end_fmt", "todoist_token"];
function getOptions() {
  var options = {};
  keys.forEach(function(k, i, a) {
    var e = document.getElementById(k);
    if (e) {
      options[k] = e.value;
      localStorage[k] = options[k];
    }
  });
  return options;
}
function getQueryParam(variable, defaultValue) {
  var query = location.search.substring(1);
  var vars = query.split('&');
  for (var i = 0; i < vars.length; i++) {
    var pair = vars[i].split('=');
    if (pair[0] === variable) {
      return decodeURIComponent(pair[1]);
    }
  }
  return defaultValue || false;
}
var submitButton = document.getElementById("submit");
submitButton.addEventListener('click', function() {
  console.log('Submit');
  var return_to = getQueryParam('return_to', 'pebblejs://close#');
  document.location = return_to + encodeURIComponent(JSON.stringify(getOptions()));
});
(function() {
  var keys = ["ifttt_token", "ifttt_event", "start_fmt", "end_fmt", "todoist_token"];
  keys.forEach(function(k, i, a) {
    if(localStorage[k]) {
      var element = document.getElementById(k);
      element.value = localStorage[k];
    }
  });
})();
</script>
</html>
